#!/bin/sh

export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin
export HOME=/root

mount /proc
mount /sys

mkdir -p /run
mount -t tmpfs -o nosuid,noexec,relatime,mode=755 tmpfs /run
mkdir -p /run/lock
mount -t tmpfs tmpfs -o nosuid,nodev,noexec,relatime /run/lock

if [ -b /dev/mtdblock1 ]; then
	name=`cat /sys/block/mtdblock1/device/name`
	mkdir -p /mnt/$name
	mount -t ext2 /dev/mtdblock1 /mnt/$name
fi

if [ -b /dev/mtdblock2 ]; then
	name=`cat /sys/block/mtdblock2/device/name`
	mkdir -p /mnt/$name
	mount -t ext2 /dev/mtdblock2 /mnt/$name
fi

ifconfig lo 127.0.0.1

cd $HOME

cmd=$(echo $1 | cut -d " " -f1)

if [ -x "$1" ]; then
	/bin/sh -c "$*"
else
	setsid sh -c 'exec sh < /dev/hvc0 > /dev/hvc0 2>&1'
fi

poweroff -f
